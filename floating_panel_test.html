<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‚¬æµ®åä½œé¢æ¿æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .test-btn:hover {
            background: #2980b9;
        }
        .test-btn.success {
            background: #27ae60;
        }
        .test-btn.success:hover {
            background: #229954;
        }
        .status {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
        }
        .feature-list {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #27ae60;
        }
        .feature-list h3 {
            margin-top: 0;
            color: #27ae60;
        }
        .feature-list ul {
            margin: 10px 0;
        }
        .feature-list li {
            margin: 5px 0;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”¥ æ‚¬æµ®åä½œé¢æ¿æµ‹è¯•</h1>
        
        <div class="status" id="status">
            å‡†å¤‡æµ‹è¯•æ‚¬æµ®åä½œé¢æ¿åŠŸèƒ½...
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <h3>ğŸ§ª æµ‹è¯•åŠŸèƒ½</h3>
            <button class="test-btn" onclick="testShowPanel()">æ˜¾ç¤ºåä½œé¢æ¿</button>
            <button class="test-btn" onclick="testCreateRoom()">æ¨¡æ‹Ÿåˆ›å»ºæˆ¿é—´</button>
            <button class="test-btn" onclick="testJoinRoom()">æ¨¡æ‹ŸåŠ å…¥æˆ¿é—´</button>
            <button class="test-btn" onclick="testUserSettings()">æµ‹è¯•ç”¨æˆ·è®¾ç½®</button>
            <button class="test-btn" onclick="hidePanel()">éšè—é¢æ¿</button>
        </div>
        
        <div class="feature-list">
            <h3>âœ¨ æ–°åŠŸèƒ½ç‰¹ç‚¹</h3>
            <ul>
                <li>âœ… <strong>ç»Ÿä¸€æ‚¬æµ®ç•Œé¢:</strong> ä¸ç®¡æ˜¯å¦åœ¨æˆ¿é—´ä¸­éƒ½æ˜¾ç¤ºæ‚¬æµ®æ¡†</li>
                <li>âœ… <strong>åŠ¨æ€å†…å®¹åˆ‡æ¢:</strong> æ ¹æ®ç”¨æˆ·çŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹</li>
                <li>âœ… <strong>ä¼˜é›…çš„UIè®¾è®¡:</strong> ç°ä»£åŒ–çš„æ‚¬æµ®é¢æ¿æ ·å¼</li>
                <li>âœ… <strong>å®Œæ•´åŠŸèƒ½æ”¯æŒ:</strong> åˆ›å»ºã€åŠ å…¥ã€ç¦»å¼€æˆ¿é—´å’Œç”¨æˆ·è®¾ç½®</li>
                <li>âœ… <strong>å®æ—¶çŠ¶æ€æ›´æ–°:</strong> è¿æ¥çŠ¶æ€å’Œç”¨æˆ·åˆ—è¡¨å®æ—¶æ˜¾ç¤º</li>
                <li>âœ… <strong>é”®ç›˜æ”¯æŒ:</strong> æˆ¿é—´å·è¾“å…¥æ¡†æ”¯æŒå›è½¦é”®</li>
                <li>âœ… <strong>é”™è¯¯å¤„ç†:</strong> å®Œå–„çš„é”™è¯¯æç¤ºå’ŒçŠ¶æ€åé¦ˆ</li>
            </ul>
        </div>
        
        <div style="margin-top: 30px;">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li><strong>é¦–æ¬¡ä½¿ç”¨:</strong> ç‚¹å‡»"æ˜¾ç¤ºåä½œé¢æ¿"æŸ¥çœ‹åˆ›å»º/åŠ å…¥ç•Œé¢</li>
                <li><strong>åˆ›å»ºæˆ¿é—´:</strong> ç‚¹å‡»"ğŸ  åˆ›å»ºæˆ¿é—´"æŒ‰é’®</li>
                <li><strong>åŠ å…¥æˆ¿é—´:</strong> è¾“å…¥æˆ¿é—´å·åç‚¹å‡»"ğŸšª åŠ å…¥æˆ¿é—´"</li>
                <li><strong>ç”¨æˆ·è®¾ç½®:</strong> å¯ä»¥è‡ªå®šä¹‰ç”¨æˆ·åå’Œé¢œè‰²</li>
                <li><strong>æˆ¿é—´ç®¡ç†:</strong> åœ¨æˆ¿é—´ä¸­æ—¶æ˜¾ç¤ºæˆ¿é—´ä¿¡æ¯å’Œç¦»å¼€æŒ‰é’®</li>
            </ol>
        </div>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin-top: 20px;">
            <h4>âš ï¸ æ³¨æ„äº‹é¡¹</h4>
            <ul>
                <li>ç¡®ä¿ä¸»é¡µé¢å·²æ­£ç¡®åŠ è½½Firebaseåä½œç®¡ç†å™¨</li>
                <li>é¢æ¿ä¼šæ ¹æ®ç”¨æˆ·æ˜¯å¦åœ¨æˆ¿é—´ä¸­è‡ªåŠ¨åˆ‡æ¢å†…å®¹</li>
                <li>æ‰€æœ‰æ“ä½œéƒ½ä¼šæœ‰çŠ¶æ€åé¦ˆå’Œé”™è¯¯æç¤º</li>
                <li>é¢æ¿å¯ä»¥é€šè¿‡å³ä¸Šè§’çš„ âœ• æŒ‰é’®å…³é—­</li>
            </ul>
        </div>
    </div>

    <script>
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            status.style.color = type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#2c3e50';
            console.log(message);
        }
        
        function testShowPanel() {
            updateStatus('æµ‹è¯•æ˜¾ç¤ºåä½œé¢æ¿...', 'info');
            
            try {
                const app = window.opener?.app || window.parent.app;
                if (app && app.firebaseManager) {
                    app.firebaseManager.showCollaborationDialog();
                    updateStatus('âœ… åä½œé¢æ¿å·²æ˜¾ç¤º', 'success');
                } else {
                    updateStatus('âŒ æ— æ³•è®¿é—®FirebaseManager', 'error');
                }
            } catch (error) {
                updateStatus('âŒ æ˜¾ç¤ºå¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function testCreateRoom() {
            updateStatus('æµ‹è¯•åˆ›å»ºæˆ¿é—´æµç¨‹...', 'info');
            
            try {
                const app = window.opener?.app || window.parent.app;
                if (app && app.firebaseManager) {
                    // å…ˆæ˜¾ç¤ºé¢æ¿
                    app.firebaseManager.showCollaborationDialog();
                    
                    // ç­‰å¾…é¢æ¿æ˜¾ç¤ºåæ¨¡æ‹Ÿç‚¹å‡»åˆ›å»ºæŒ‰é’®
                    setTimeout(() => {
                        const createBtn = (window.opener || window.parent).document.getElementById('firebase-create-room-btn');
                        if (createBtn) {
                            updateStatus('âœ… æ‰¾åˆ°åˆ›å»ºæˆ¿é—´æŒ‰é’®ï¼Œå¯ä»¥æ‰‹åŠ¨ç‚¹å‡»æµ‹è¯•', 'success');
                        } else {
                            updateStatus('âš ï¸ æœªæ‰¾åˆ°åˆ›å»ºæˆ¿é—´æŒ‰é’®ï¼Œå¯èƒ½éœ€è¦åˆ·æ–°', 'error');
                        }
                    }, 500);
                } else {
                    updateStatus('âŒ æ— æ³•è®¿é—®FirebaseManager', 'error');
                }
            } catch (error) {
                updateStatus('âŒ æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function testJoinRoom() {
            updateStatus('æµ‹è¯•åŠ å…¥æˆ¿é—´æµç¨‹...', 'info');
            
            try {
                const app = window.opener?.app || window.parent.app;
                if (app && app.firebaseManager) {
                    // å…ˆæ˜¾ç¤ºé¢æ¿
                    app.firebaseManager.showCollaborationDialog();
                    
                    // ç­‰å¾…é¢æ¿æ˜¾ç¤ºåå¡«å…¥æµ‹è¯•æˆ¿é—´å·
                    setTimeout(() => {
                        const roomInput = (window.opener || window.parent).document.getElementById('firebase-room-id-input');
                        if (roomInput) {
                            roomInput.value = 'test_room_123';
                            updateStatus('âœ… å·²å¡«å…¥æµ‹è¯•æˆ¿é—´å·ï¼Œå¯ä»¥ç‚¹å‡»åŠ å…¥æŒ‰é’®æµ‹è¯•', 'success');
                        } else {
                            updateStatus('âš ï¸ æœªæ‰¾åˆ°æˆ¿é—´å·è¾“å…¥æ¡†', 'error');
                        }
                    }, 500);
                } else {
                    updateStatus('âŒ æ— æ³•è®¿é—®FirebaseManager', 'error');
                }
            } catch (error) {
                updateStatus('âŒ æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function testUserSettings() {
            updateStatus('æµ‹è¯•ç”¨æˆ·è®¾ç½®...', 'info');
            
            try {
                const app = window.opener?.app || window.parent.app;
                if (app && app.firebaseManager) {
                    // å…ˆæ˜¾ç¤ºé¢æ¿
                    app.firebaseManager.showCollaborationDialog();
                    
                    // ç­‰å¾…é¢æ¿æ˜¾ç¤ºåå¡«å…¥æµ‹è¯•è®¾ç½®
                    setTimeout(() => {
                        const nameInput = (window.opener || window.parent).document.getElementById('firebase-username-input');
                        const colorInput = (window.opener || window.parent).document.getElementById('firebase-color-input');
                        
                        if (nameInput && colorInput) {
                            nameInput.value = 'æµ‹è¯•ç”¨æˆ·_' + Math.random().toString(36).substr(2, 5);
                            colorInput.value = '#' + Math.floor(Math.random()*16777215).toString(16);
                            updateStatus('âœ… å·²å¡«å…¥æµ‹è¯•è®¾ç½®ï¼Œå¯ä»¥ç‚¹å‡»ä¿å­˜æŒ‰é’®æµ‹è¯•', 'success');
                        } else {
                            updateStatus('âš ï¸ æœªæ‰¾åˆ°è®¾ç½®è¾“å…¥æ¡†', 'error');
                        }
                    }, 500);
                } else {
                    updateStatus('âŒ æ— æ³•è®¿é—®FirebaseManager', 'error');
                }
            } catch (error) {
                updateStatus('âŒ æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function hidePanel() {
            updateStatus('éšè—åä½œé¢æ¿...', 'info');
            
            try {
                const app = window.opener?.app || window.parent.app;
                if (app && app.firebaseManager && app.firebaseManager.hideFloatingCollaborationPanel) {
                    app.firebaseManager.hideFloatingCollaborationPanel();
                    updateStatus('âœ… åä½œé¢æ¿å·²éšè—', 'success');
                } else {
                    // å°è¯•ç›´æ¥åˆ é™¤é¢æ¿å…ƒç´ 
                    const panel = (window.opener || window.parent).document.getElementById('firebase-collaboration-panel');
                    if (panel) {
                        panel.remove();
                        updateStatus('âœ… åä½œé¢æ¿å·²å¼ºåˆ¶éšè—', 'success');
                    } else {
                        updateStatus('âš ï¸ æœªæ‰¾åˆ°åä½œé¢æ¿', 'error');
                    }
                }
            } catch (error) {
                updateStatus('âŒ éšè—å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', () => {
            try {
                const app = window.opener?.app || window.parent.app;
                if (app && app.firebaseManager) {
                    const fm = app.firebaseManager;
                    updateStatus(`Firebase Manager çŠ¶æ€: ${fm.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}, ${fm.roomId ? 'åœ¨æˆ¿é—´ä¸­(' + fm.roomId + ')' : 'æœªåŠ å…¥æˆ¿é—´'}`, 'success');
                } else {
                    updateStatus('æ— æ³•è®¿é—®ä¸»é¡µé¢ï¼Œè¯·ç¡®ä¿ä»ä¸»é¡µé¢æ‰“å¼€æ­¤æµ‹è¯•å·¥å…·', 'error');
                }
            } catch (error) {
                updateStatus('é¡µé¢åŠ è½½æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
            }
        });
    </script>
</body>
</html>
