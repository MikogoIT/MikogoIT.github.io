<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebaseåä½œåŠŸèƒ½æ¼”ç¤º - æ²¡æœ‰æˆ¿é—´æ—¶çš„æ‚¬æµ®é¢æ¿</title>
    <link rel="stylesheet" href="css/firebase-collaboration.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .demo-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .demo-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }
        
        .demo-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 150px;
        }
        
        .demo-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .demo-btn.create { background: #27ae60; }
        .demo-btn.create:hover { background: #219a52; }
        
        .demo-btn.join { background: #f39c12; }
        .demo-btn.join:hover { background: #e67e22; }
        
        .demo-btn.leave { background: #e74c3c; }
        .demo-btn.leave:hover { background: #c0392b; }
        
        .demo-btn.diagnostic { background: #9b59b6; }
        .demo-btn.diagnostic:hover { background: #8e44ad; }
        
        .status-display {
            background: white;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .status-value {
            color: #27ae60;
            font-family: monospace;
        }
        
        .instructions {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #2980b9;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 8px 0;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>ğŸ”¥ Firebaseåä½œåŠŸèƒ½æ¼”ç¤º</h1>
            <p>æµ‹è¯•åœ¨<strong>æ²¡æœ‰æˆ¿é—´æ—¶</strong>ç‚¹å‡»åä½œæŒ‰é’®çš„è¡Œä¸º</p>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li><strong>ç‚¹å‡»"æ˜¾ç¤ºåä½œé¢æ¿"</strong> - æµ‹è¯•åœ¨æ²¡æœ‰æˆ¿é—´æ—¶æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºåˆ›å»º/åŠ å…¥ç•Œé¢</li>
                <li><strong>ç‚¹å‡»"æ¨¡æ‹Ÿåˆ›å»ºæˆ¿é—´"</strong> - æ¨¡æ‹Ÿåˆ›å»ºæˆ¿é—´åå†æ˜¾ç¤ºé¢æ¿ï¼ˆåº”æ˜¾ç¤ºæˆ¿é—´ä¿¡æ¯ï¼‰</li>
                <li><strong>ç‚¹å‡»"æ¨¡æ‹Ÿç¦»å¼€æˆ¿é—´"</strong> - æ¨¡æ‹Ÿç¦»å¼€æˆ¿é—´åçš„çŠ¶æ€</li>
                <li><strong>ç‚¹å‡»"è¿è¡Œè¯Šæ–­"</strong> - è‡ªåŠ¨æ£€æŸ¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸</li>
                <li>è§‚å¯Ÿå³ä¸Šè§’çš„æ‚¬æµ®é¢æ¿å˜åŒ–å’Œæ§åˆ¶å°è¾“å‡º</li>
            </ol>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ›ï¸ æµ‹è¯•æ§åˆ¶</h3>
            <div class="demo-buttons">
                <button class="demo-btn" onclick="testShowCollaboration()">
                    ğŸ  æ˜¾ç¤ºåä½œé¢æ¿
                </button>
                <button class="demo-btn create" onclick="simulateCreateRoom()">
                    â• æ¨¡æ‹Ÿåˆ›å»ºæˆ¿é—´
                </button>
                <button class="demo-btn join" onclick="simulateJoinRoom()">
                    ğŸšª æ¨¡æ‹ŸåŠ å…¥æˆ¿é—´
                </button>
                <button class="demo-btn leave" onclick="simulateLeaveRoom()">
                    âŒ æ¨¡æ‹Ÿç¦»å¼€æˆ¿é—´
                </button>
                <button class="demo-btn diagnostic" onclick="runDiagnostics()">
                    ğŸ” è¿è¡Œè¯Šæ–­
                </button>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
            <div class="status-display" id="status-display">
                <div class="status-item">
                    <span class="status-label">æˆ¿é—´çŠ¶æ€:</span>
                    <span class="status-value" id="room-status">âŒ ä¸åœ¨æˆ¿é—´ä¸­</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ç”¨æˆ·æ¨¡å¼:</span>
                    <span class="status-value" id="user-mode">ğŸ‘¤ è®¿å®¢</span>
                </div>
                <div class="status-item">
                    <span class="status-label">è¿æ¥çŠ¶æ€:</span>
                    <span class="status-value" id="connection-status">ğŸŸ¢ å·²è¿æ¥</span>
                </div>
                <div class="status-item">
                    <span class="status-label">é¢æ¿çŠ¶æ€:</span>
                    <span class="status-value" id="panel-status">éšè—</span>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <div style="background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 13px; max-height: 300px; overflow-y: auto;" id="log-output">
                é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡è¿›è¡Œæµ‹è¯•...<br>
            </div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹ŸFirebaseåä½œç®¡ç†å™¨
        class DemoFirebaseManager {
            constructor() {
                this.roomId = null;
                this.isHost = false;
                this.userName = 'DemoUser';
                this.userColor = '#3498db';
                this.isInitialized = true;
                this.isConnected = true;
                this.userId = 'demo-' + Math.random().toString(36).substr(2, 8);
                
                this.log('âœ… Demo Firebaseåä½œç®¡ç†å™¨å·²åˆå§‹åŒ–');
                this.updateStatus();
            }
            
            log(message) {
                const timestamp = new Date().toLocaleTimeString();
                const logOutput = document.getElementById('log-output');
                logOutput.innerHTML += `<span style="color: #74b9ff;">[${timestamp}]</span> ${message}<br>`;
                logOutput.scrollTop = logOutput.scrollHeight;
                console.log(message);
            }
            
            updateStatus() {
                document.getElementById('room-status').textContent = 
                    this.roomId ? `ğŸ  æˆ¿é—´: ${this.roomId}` : 'âŒ ä¸åœ¨æˆ¿é—´ä¸­';
                    
                document.getElementById('user-mode').textContent = 
                    this.roomId ? (this.isHost ? 'ğŸ‘‘ æˆ¿ä¸»' : 'ğŸ‘¥ æˆå‘˜') : 'ğŸ‘¤ è®¿å®¢';
                    
                document.getElementById('connection-status').textContent = 
                    this.isConnected ? 'ğŸŸ¢ å·²è¿æ¥' : 'ğŸ”´ å·²æ–­å¼€';
                    
                const panel = document.getElementById('firebase-collaboration-panel');
                document.getElementById('panel-status').textContent = 
                    panel ? 'æ˜¾ç¤ºä¸­' : 'éšè—';
            }
            
            showCollaborationDialog() {
                this.log('ğŸ¯ è°ƒç”¨ showCollaborationDialog()');
                
                // ç§»é™¤å·²å­˜åœ¨çš„é¢æ¿
                const existingPanel = document.getElementById('firebase-collaboration-panel');
                if (existingPanel) {
                    existingPanel.remove();
                    this.log('ğŸ—‘ï¸ ç§»é™¤äº†å·²å­˜åœ¨çš„é¢æ¿');
                }
                
                this.showFloatingCollaborationPanel();
            }
            
            showFloatingCollaborationPanel() {
                this.log('ğŸ  æ˜¾ç¤ºFirebaseåä½œæ‚¬æµ®é¢æ¿');
                
                const panel = document.createElement('div');
                panel.id = 'firebase-collaboration-panel';
                panel.className = 'firebase-collaboration-panel';
                
                if (this.roomId) {
                    this.log('ğŸ“± ç”¨æˆ·åœ¨æˆ¿é—´ä¸­ï¼Œæ˜¾ç¤ºæˆ¿é—´ä¿¡æ¯ç•Œé¢');
                    panel.innerHTML = this.getRoomInfoContent();
                } else {
                    this.log('ğŸ†• ç”¨æˆ·ä¸åœ¨æˆ¿é—´ä¸­ï¼Œæ˜¾ç¤ºåˆ›å»º/åŠ å…¥ç•Œé¢');
                    panel.innerHTML = this.getCreateJoinContent();
                }
                
                document.body.appendChild(panel);
                this.log('âœ… æ‚¬æµ®é¢æ¿å·²æ·»åŠ åˆ°DOM');
                this.updateStatus();
                
                // ç»‘å®šäº‹ä»¶
                setTimeout(() => {
                    this.bindPanelEvents(panel);
                }, 100);
            }
            
            getRoomInfoContent() {
                return `
                    <div class="panel-header">
                        <h3>ğŸ  Firebaseåä½œæˆ¿é—´</h3>
                        <button id="close-panel-btn" class="close-panel-btn" title="å…³é—­">âœ•</button>
                    </div>
                    <div class="connection-status">
                        <span class="status-badge connected">âœ… å·²è¿æ¥</span>
                    </div>
                    <div class="room-details">
                        <p><strong>æˆ¿é—´å·:</strong> 
                           <span>${this.roomId}</span> 
                           <button id="copy-room-id" class="copy-btn" title="å¤åˆ¶æˆ¿é—´å·">ğŸ“‹</button>
                        </p>
                        <p><strong>æ¨¡å¼:</strong> ${this.isHost ? 'ğŸ‘‘ æˆ¿ä¸»æ¨¡å¼' : 'ğŸ‘¥ æˆå‘˜æ¨¡å¼'}</p>
                        <p><strong>è¿æ¥æ•°:</strong> 1 äººåœ¨çº¿</p>
                    </div>
                    <div class="room-actions">
                        <button id="leave-room-btn" class="action-btn danger">ğŸšª ç¦»å¼€æˆ¿é—´</button>
                    </div>
                `;
            }
            
            getCreateJoinContent() {
                return `
                    <div class="panel-header">
                        <h3>ğŸ”¥ Firebaseå¤šäººåä½œ</h3>
                        <button id="close-panel-btn" class="close-panel-btn" title="å…³é—­">âœ•</button>
                    </div>
                    <div class="connection-status">
                        <p><strong>è¿æ¥æ¨¡å¼:</strong> Firebaseå®æ—¶æ•°æ®åº“</p>
                        <p><strong>åˆå§‹åŒ–:</strong> âœ… å·²åˆå§‹åŒ–</p>
                        <p><strong>è¿æ¥çŠ¶æ€:</strong> âœ… å·²è¿æ¥</p>
                    </div>
                    <div class="room-actions">
                        <h4>ğŸ  æˆ¿é—´æ“ä½œ</h4>
                        <button id="firebase-create-room-btn" class="action-btn primary">
                            ğŸ  åˆ›å»ºæˆ¿é—´
                        </button>
                        
                        <div class="join-room-section">
                            <h4>ğŸšª åŠ å…¥æˆ¿é—´</h4>
                            <input type="text" id="firebase-room-id-input" placeholder="è¾“å…¥æˆ¿é—´å·" class="room-input" />
                            <button id="firebase-join-room-btn" class="action-btn primary">
                                ğŸšª åŠ å…¥æˆ¿é—´
                            </button>
                        </div>
                        
                        <div class="user-settings">
                            <h4>âš™ï¸ ç”¨æˆ·è®¾ç½®</h4>
                            <input type="text" id="firebase-username-input" placeholder="ç”¨æˆ·å" value="${this.userName}" class="settings-input" />
                            <input type="color" id="firebase-color-input" value="${this.userColor}" class="color-input" />
                            <button id="firebase-save-settings-btn" class="action-btn secondary">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
                        </div>
                    </div>
                    
                    <div class="firebase-info">
                        <h4>â„¹ï¸ åŠŸèƒ½è¯´æ˜</h4>
                        <ul>
                            <li>ğŸŒ è·¨è®¾å¤‡æ”¯æŒï¼šä¸åŒè®¾å¤‡é—´å®æ—¶åä½œ</li>
                            <li>âš¡ å®æ—¶åŒæ­¥ï¼šæ“ä½œå®æ—¶åŒæ­¥åˆ°æ‰€æœ‰ç”¨æˆ·</li>
                            <li>ğŸ”„ æ–­çº¿é‡è¿ï¼šè‡ªåŠ¨å¤„ç†ç½‘ç»œé—®é¢˜</li>
                            <li>ğŸ’¾ æ•°æ®æŒä¹…åŒ–ï¼šçŠ¶æ€ä¿å­˜åœ¨äº‘ç«¯</li>
                        </ul>
                    </div>
                `;
            }
            
            bindPanelEvents(panel) {
                this.log('ğŸ”§ ç»‘å®šé¢æ¿äº‹ä»¶');
                
                // å…³é—­æŒ‰é’®
                const closeBtn = panel.querySelector('#close-panel-btn');
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        panel.remove();
                        this.log('âœ… é¢æ¿å·²å…³é—­');
                        this.updateStatus();
                    });
                }
                
                if (this.roomId) {
                    // æˆ¿é—´æ¨¡å¼äº‹ä»¶
                    const leaveBtn = panel.querySelector('#leave-room-btn');
                    if (leaveBtn) {
                        leaveBtn.addEventListener('click', () => {
                            this.leaveRoom();
                        });
                    }
                    
                    const copyBtn = panel.querySelector('#copy-room-id');
                    if (copyBtn) {
                        copyBtn.addEventListener('click', () => {
                            this.log('ğŸ“‹ æˆ¿é—´å·å·²å¤åˆ¶');
                        });
                    }
                } else {
                    // åˆ›å»º/åŠ å…¥æ¨¡å¼äº‹ä»¶
                    const createBtn = panel.querySelector('#firebase-create-room-btn');
                    if (createBtn) {
                        createBtn.addEventListener('click', () => {
                            this.createRoom();
                        });
                    }
                    
                    const joinBtn = panel.querySelector('#firebase-join-room-btn');
                    if (joinBtn) {
                        joinBtn.addEventListener('click', () => {
                            const input = panel.querySelector('#firebase-room-id-input');
                            const roomId = input ? input.value.trim() : '';
                            if (roomId) {
                                this.joinRoom(roomId);
                            } else {
                                this.log('âš ï¸ è¯·è¾“å…¥æˆ¿é—´å·');
                            }
                        });
                    }
                    
                    const saveBtn = panel.querySelector('#firebase-save-settings-btn');
                    if (saveBtn) {
                        saveBtn.addEventListener('click', () => {
                            const nameInput = panel.querySelector('#firebase-username-input');
                            const colorInput = panel.querySelector('#firebase-color-input');
                            
                            if (nameInput) this.userName = nameInput.value;
                            if (colorInput) this.userColor = colorInput.value;
                            
                            this.log(`ğŸ’¾ ç”¨æˆ·è®¾ç½®å·²ä¿å­˜: ${this.userName}, ${this.userColor}`);
                        });
                    }
                }
            }
            
            createRoom() {
                this.roomId = 'demo-' + Math.random().toString(36).substr(2, 6);
                this.isHost = true;
                this.log(`ğŸ  åˆ›å»ºæˆ¿é—´æˆåŠŸ: ${this.roomId}`);
                this.updateStatus();
                
                // åˆ·æ–°é¢æ¿
                const panel = document.getElementById('firebase-collaboration-panel');
                if (panel) {
                    panel.remove();
                    this.showFloatingCollaborationPanel();
                }
            }
            
            joinRoom(roomId) {
                this.roomId = roomId;
                this.isHost = false;
                this.log(`ğŸšª åŠ å…¥æˆ¿é—´æˆåŠŸ: ${roomId}`);
                this.updateStatus();
                
                // åˆ·æ–°é¢æ¿
                const panel = document.getElementById('firebase-collaboration-panel');
                if (panel) {
                    panel.remove();
                    this.showFloatingCollaborationPanel();
                }
            }
            
            leaveRoom() {
                const oldRoomId = this.roomId;
                this.roomId = null;
                this.isHost = false;
                this.log(`ğŸšª ç¦»å¼€æˆ¿é—´: ${oldRoomId}`);
                this.updateStatus();
                
                // å…³é—­é¢æ¿
                const panel = document.getElementById('firebase-collaboration-panel');
                if (panel) {
                    panel.remove();
                }
            }
        }
        
        // åˆ›å»ºæ¼”ç¤ºç®¡ç†å™¨å®ä¾‹
        window.demoManager = new DemoFirebaseManager();
        
        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.testShowCollaboration = function() {
            window.demoManager.showCollaborationDialog();
        };
        
        window.simulateCreateRoom = function() {
            window.demoManager.createRoom();
        };
        
        window.simulateJoinRoom = function() {
            const roomId = 'test-' + Math.random().toString(36).substr(2, 4);
            window.demoManager.joinRoom(roomId);
        };
        
        window.simulateLeaveRoom = function() {
            window.demoManager.leaveRoom();
        };
        
        window.runDiagnostics = function() {
            window.demoManager.log('ğŸ” å¼€å§‹è¿è¡Œè¯Šæ–­...');
            window.demoManager.log('âœ… æ¼”ç¤ºç¯å¢ƒè¯Šæ–­é€šè¿‡');
            window.demoManager.log('âœ… æ‚¬æµ®é¢æ¿åŠŸèƒ½æ­£å¸¸');
            window.demoManager.log('âœ… åˆ›å»º/åŠ å…¥ç•Œé¢æ­£å¸¸');
            window.demoManager.log('âœ… æˆ¿é—´ä¿¡æ¯ç•Œé¢æ­£å¸¸');
            window.demoManager.log('ğŸ“Š è¯Šæ–­å®Œæˆï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ');
        };
    </script>
</body>
</html>
